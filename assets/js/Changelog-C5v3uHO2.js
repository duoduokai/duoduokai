import{B as h,r as w,j as n,C as E,ac as $,T as g,a1 as S,t as N,au as P,bA as W,a0 as z,bB as T}from"./mui-C7so6SPd.js";import{B as F,A as D,F as H}from"./BackButton-Crhaa-PS.js";import{m as J}from"./motion-DFvL2RdT.js";const G="modulepreload",q=function(e){return"/duoduokai/"+e},C={},K=function(t,s,l){let p=Promise.resolve();if(s&&s.length>0){let o=function(a){return Promise.all(a.map(x=>Promise.resolve(x).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),i=d?.nonce||d?.getAttribute("nonce");p=o(s.map(a=>{if(a=q(a),a in C)return;C[a]=!0;const x=a.endsWith(".css"),c=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const r=document.createElement("link");if(r.rel=x?"stylesheet":G,x||(r.as="script"),r.crossOrigin="",r.href=a,i&&r.setAttribute("nonce",i),document.head.appendChild(r),x)return new Promise((M,B)=>{r.addEventListener("load",M),r.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${a}`)))})}))}function u(o){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=o,window.dispatchEvent(d),!d.defaultPrevented)throw o}return p.then(o=>{for(const d of o||[])d.status==="rejected"&&u(d.reason);return t().catch(u)})},j="duoduokai_user",v="duoduokai_token",y=[];function V(e){return y.push(e),()=>{const t=y.indexOf(e);t>-1&&y.splice(t,1)}}function A(e){y.forEach(t=>{try{t(e)}catch{}})}function L(e){try{localStorage.setItem(j,JSON.stringify(e)),A(e)}catch{}}function Y(e){try{localStorage.setItem(v,e)}catch{}}function O(){try{const e=localStorage.getItem(j);return e?JSON.parse(e):null}catch{return null}}function b(){try{return localStorage.getItem(v)}catch{return null}}function k(){try{localStorage.removeItem(j),localStorage.removeItem(v),A(null)}catch{}}function Z(){return O()!==null&&b()!==null}function R(){const e=b();return e?{Authorization:`Bearer ${e}`}:{}}async function Q(){try{if(!b())return null;const{getCurrentUser:t}=await K(async()=>{const{getCurrentUser:l}=await Promise.resolve().then(()=>fe);return{getCurrentUser:l}},void 0),s=await t();return L(s),s}catch{return k(),null}}const xe=Object.freeze(Object.defineProperty({__proto__:null,addUserStateListener:V,clearUser:k,getAuthHeaders:R,getToken:b,getUser:O,isLoggedIn:Z,refreshUserInfo:Q,saveToken:Y,saveUser:L},Symbol.toStringTag,{value:"Module"})),X=()=>typeof window<"u"&&window.location.hostname==="duoduokai.github.io"?"https://www.duoduokai.shop/api":"/api",ee={REAL_API_BASE_URL:X()},ye="1.0.0";class re{config;isProduction;constructor(){this.isProduction=!0,this.config={enableConsole:!this.isProduction,enableRemoteLogging:this.isProduction,logLevel:this.isProduction?"warn":"debug"}}shouldLog(t){if(!this.config.enableConsole)return!1;const s=["debug","info","warn","error"],l=s.indexOf(this.config.logLevel);return s.indexOf(t)>=l}formatMessage(t,s){return`${`[${new Date().toISOString()}] [${t.toUpperCase()}]`} ${s}`}debug(t,...s){this.shouldLog("debug")}info(t,...s){this.shouldLog("info")}warn(t,...s){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",t),...s)}error(t,...s){console.error(this.formatMessage("error",t),...s),this.config.enableRemoteLogging&&this.sendToRemoteLogging("error",t,s)}sensitive(t,...s){this.isProduction}network(t,...s){this.isProduction&&(t.toLowerCase().includes("error")||t.toLowerCase().includes("fail"))&&this.error(`[NETWORK] ${t}`,...s)}userAction(t,...s){this.isProduction}sendToRemoteLogging(t,s,l){try{fetch("/api/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:t,message:s,args:l.length>0?l:void 0,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href})}).catch(()=>{})}catch{}}setConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}const f=new re;f.debug.bind(f);f.info.bind(f);f.warn.bind(f);const te=f.error.bind(f);f.sensitive.bind(f);const _=f.network.bind(f);f.userAction.bind(f);const I=ee.REAL_API_BASE_URL;async function m(e,t={},s=2){const l=`${I}${e}`,u={headers:{"Content-Type":"application/json",Accept:"application/json",...R(),...t.headers},mode:"cors",credentials:"omit",...t};try{_("ğŸŒ å‘é€APIè¯·æ±‚:",l,u);const o=await fetch(l,u);if(_("ğŸ“¡ APIå“åº”çŠ¶æ€:",o.status,o.statusText),!o.ok){const i=await o.json().catch(()=>({}));if(te("âŒ APIé”™è¯¯:",i),o.status===401){const c=i.detail||i.message||i.error||"";let r="ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•";throw c&&(r=c),k(),new Error(r)}let a=null;if(o.status===400&&e==="/login"){const c=i.detail||i.message||i.error||"";c?a=c:a="ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•"}if(o.status===400&&e==="/register"){const r=(i.message||i.error||i.detail||"").toLowerCase();r.includes("username")||r.includes("ç”¨æˆ·å")||r.includes("å·²å­˜åœ¨")||r.includes("exists")||r.includes("taken")||r.includes("duplicate")||r.includes("already")||r.includes("occupied")||r.includes("in use")||r.includes("å·²è¢«")||r.includes("é‡å¤")||r.includes("å†²çª")||r.includes("conflict")?a="è¯¥ç”¨æˆ·åå·²æ³¨å†Œï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·å":r.includes("username format")||r.includes("ç”¨æˆ·åæ ¼å¼")||r.includes("invalid username")||r.includes("username invalid")||r.includes("æ ¼å¼ä¸æ­£ç¡®")||r.includes("ä¸ç¬¦åˆè¦æ±‚")?a="ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿":r.includes("password")||r.includes("å¯†ç ")||r.includes("weak")||r.includes("too short")||r.includes("too long")||r.includes("ä¸ç¬¦åˆ")||r.includes("é•¿åº¦")?a="å¯†ç æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ç¡®ä¿å¯†ç é•¿åº¦è‡³å°‘6ä½":r.includes("validation")||r.includes("éªŒè¯")||r.includes("required")||r.includes("å¿…å¡«")||r.includes("missing")||r.includes("ç¼ºå°‘")?a="è¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯æ˜¯å¦å®Œæ•´":a="æ³¨å†Œä¿¡æ¯æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•"}if(o.status===400&&e.includes("/checkin")){const r=(i.message||i.error||i.detail||"").toLowerCase();r.includes("ä»Šæ—¥å·²æ‰“å¡")||r.includes("already checked in")||r.includes("already checked-in")||r.includes("already checked")||r.includes("duplicate check-in")||r.includes("é‡å¤æ‰“å¡")?a="ä»Šæ—¥å·²æ‰“å¡ï¼Œè¯·æ˜å¤©å†æ¥ï¼":(r.includes("check-in")||r.includes("æ‰“å¡")||r.includes("ç­¾åˆ°"))&&(a="æ‰“å¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}if(o.status===500){let c=null;throw e==="/register"?c="æ³¨å†ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•ã€‚å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»å®¢æœã€‚":e==="/login"?c="ç™»å½•æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•ã€‚å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»å®¢æœã€‚":c="æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•ã€‚å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»å®¢æœã€‚",new Error(c)}const x=a||i.message||`HTTP error! status: ${o.status}`;throw new Error(x)}return await o.json()}catch(o){if(s>0&&(o instanceof TypeError||o instanceof Error&&o.message.includes("Failed to fetch")))return await new Promise(d=>setTimeout(d,1e3)),m(e,t,s-1);throw o instanceof Error?o.message.includes("Failed to fetch")||o.message.includes("CORS")?new Error("APIæœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•"):new Error(o.message):new Error("ç½‘ç»œè¯·æ±‚å¤±è´¥")}}async function se(e){let s=null;for(let l=1;l<=3;l++)try{return await m("/register",{method:"POST",body:JSON.stringify(e)})}catch(p){if(s=p instanceof Error?p:new Error("æœªçŸ¥é”™è¯¯"),s.message.includes("æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨")&&l<3){await new Promise(u=>setTimeout(u,l*1e3));continue}throw s}throw s||new Error("æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}async function ne(e,t){const s=new URLSearchParams;return s.append("username",e.username),s.append("password",e.password),t&&(s.append("platform_type",t.platformType),s.append("client_version",t.clientVersion),s.append("device_info",JSON.stringify(t))),m("/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s.toString()})}async function oe(){return m("/users/me")}async function ae(e){return m("/payment/purchase",{method:"POST",body:JSON.stringify(e)})}async function ie(e){return m(`/payment/status/${e}`,{method:"GET"})}async function ce(){return m("/users/me/platform-packages")}async function le(){try{return await m("/promotion-banner")}catch(e){return console.error("è·å–æ´»åŠ¨æ¨å¹¿Bannerå¤±è´¥:",e),null}}async function ue(e){const t=e?`?platform=${e}`:"";try{const s=await fetch(`${I}/packages${t}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",credentials:"omit"});if(!s.ok)throw new Error(`HTTP ${s.status}`);return await s.json()}catch(s){return console.error("è·å–å¥—é¤åˆ—è¡¨å¤±è´¥:",s),{success:!1,data:[]}}}async function U(e=0,t=50){return m(`/changelog?skip=${e}&limit=${t}`)}async function de(e){return m("/support-tickets",{method:"POST",body:JSON.stringify(e)})}const fe=Object.freeze(Object.defineProperty({__proto__:null,apiRequest:m,checkPaymentStatus:ie,createPaymentOrder:ae,getChangelog:U,getCurrentUser:oe,getPackages:ue,getPromotionBanner:le,getUserPlatformPackages:ce,loginUser:ne,registerUser:se,submitSupportTicket:de},Symbol.toStringTag,{value:"Module"})),ge=J(h);function be(){const[e,t]=w.useState([]),[s,l]=w.useState(!0);w.useEffect(()=>{(async()=>{try{l(!0);const o=await U(0,50);o&&o.data&&o.data.changelog?t(o.data.changelog):t([])}catch(o){console.error("è·å–æ›´æ–°æ—¥å¿—å¤±è´¥:",o),t([{id:1,version:"v2.1.0",date:"2024-12-01",type:"feature",title:"æ–°å¢æ‰¹é‡æ“ä½œåŠŸèƒ½",description:"æ”¯æŒæ‰¹é‡é€€æ¬¾ç”³è¯·ã€æ‰¹é‡å‘è´§ã€æ‰¹é‡å‘ç¥¨ç”³è¯·ç­‰æ“ä½œï¼Œå¤§å¹…æå‡å·¥ä½œæ•ˆç‡ã€‚",features:["æ–°å¢æ‰¹é‡é€€æ¬¾ç”³è¯·åŠŸèƒ½","æ–°å¢æ‰¹é‡å‘è´§åŠŸèƒ½","æ–°å¢æ‰¹é‡å‘ç¥¨ç”³è¯·åŠŸèƒ½","ä¼˜åŒ–æ“ä½œç•Œé¢ï¼Œæå‡ç”¨æˆ·ä½“éªŒ"],created_at:"2024-12-01T00:00:00Z",created_by:"admin"}])}finally{l(!1)}})()},[]);const p=u=>{switch(u){case"feature":return n.jsx(T,{});case"major":return n.jsx(T,{});case"security":return n.jsx(z,{});case"bugfix":return n.jsx(W,{});case"performance":return n.jsx(P,{});default:return n.jsx(P,{})}};return s?n.jsxs(E,{maxWidth:"lg",sx:{py:8,textAlign:"center"},children:[n.jsx($,{size:60}),n.jsx(g,{variant:"h6",sx:{mt:2},children:"æ­£åœ¨åŠ è½½æ›´æ–°æ—¥å¿—..."})]}):n.jsxs(h,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",display:"flex",flexDirection:"column"},children:[n.jsxs(E,{maxWidth:"lg",sx:{flex:1,py:4},children:[n.jsxs(h,{sx:{mb:4},children:[n.jsx(F,{href:"/",text:"è¿”å›é¦–é¡µ",variant:"link"}),n.jsxs(h,{sx:{textAlign:"center"},children:[n.jsx(g,{variant:"h3",component:"h1",sx:{fontWeight:700,mb:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"æ›´æ–°æ—¥å¿—"}),n.jsx(g,{variant:"h6",sx:{color:"text.secondary",maxWidth:800,mx:"auto"},children:"äº†è§£å¤šå¤šå¼€è½¯ä»¶çš„æœ€æ–°åŠŸèƒ½å’Œæ”¹è¿›"})]})]}),n.jsxs(ge,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:D.duration.base},children:[!e||e.length===0?n.jsxs(S,{elevation:4,sx:{p:4,borderRadius:"20px",textAlign:"center",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)"},children:[n.jsx(g,{variant:"h6",color:"text.secondary",children:"æš‚æ— æ›´æ–°æ—¥å¿—"}),n.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"è¯·ç¨åå†æ¥æŸ¥çœ‹æœ€æ–°æ›´æ–°"})]}):n.jsx(h,{sx:{display:"flex",flexDirection:"column",gap:4},children:e.map((u,o)=>n.jsxs(S,{elevation:6,sx:{p:4,borderRadius:"20px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",boxShadow:"0 12px 40px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 16px 48px rgba(0,0,0,0.15)",transform:"translateY(-4px)"}},children:[n.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:3,mb:4},children:[n.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:56,height:56,borderRadius:"16px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",boxShadow:"0 4px 20px rgba(102, 126, 234, 0.3)"},children:p(u.type)}),n.jsxs(h,{children:[n.jsx(g,{variant:"h4",sx:{fontWeight:700,color:"primary.main",fontSize:"1.5rem",mb:1},children:u.version}),n.jsx(N,{label:u.date,size:"medium",variant:"outlined",sx:{borderRadius:"12px",fontSize:"0.9rem",fontWeight:500}})]})]}),n.jsx(g,{variant:"h5",gutterBottom:!0,sx:{fontWeight:600,color:"text.primary",fontSize:"1.3rem",mb:3},children:u.title}),n.jsx(h,{sx:{backgroundColor:"rgba(0,0,0,0.03)",padding:3,borderRadius:2,border:"1px solid rgba(0,0,0,0.08)",whiteSpace:"pre-wrap",fontFamily:"inherit",lineHeight:1.8},children:u.description.split(`
`).map((d,i)=>{const a=d.trim(),x=/^[ğŸš€ğŸ›âœ¨ğŸ”§ğŸ“ğŸ¨]/u.test(a),c=/^[â€¢Â·]/u.test(a);return a?x?n.jsx(g,{variant:"h6",color:"primary.main",sx:{fontWeight:600,mb:2,mt:i>0?3:0,fontSize:"1.1rem"},children:a},i):c?n.jsx(g,{variant:"body1",color:"text.primary",sx:{fontWeight:500,mb:1,ml:2,fontSize:"1rem"},children:a},i):n.jsx(g,{variant:"body1",color:"text.secondary",sx:{mb:1,ml:4,fontSize:"0.95rem",lineHeight:1.6},children:a},i):n.jsx(h,{sx:{height:"1.5em"}},i)})})]},u.id||o))}),n.jsx(h,{sx:{mt:8,textAlign:"center"},children:n.jsxs(S,{elevation:4,sx:{p:4,borderRadius:"20px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",maxWidth:600,mx:"auto"},children:[n.jsx(g,{variant:"h6",gutterBottom:!0,fontWeight:"bold",color:"primary.main",children:"ç‰ˆæœ¬è¯´æ˜"}),n.jsx(g,{variant:"body2",color:"text.secondary",paragraph:!0,children:"æˆ‘ä»¬è‡´åŠ›äºæŒç»­æ”¹è¿›å¤šå¤šå¼€è½¯ä»¶ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ä½¿ç”¨ä½“éªŒã€‚"}),n.jsx(g,{variant:"body2",color:"text.secondary",children:"å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡å®¢æœè”ç³»æˆ‘ä»¬ã€‚"})]})})]})]}),n.jsx(H,{})]})}export{ye as A,be as C,K as _,ae as a,L as b,ie as c,se as d,ue as e,V as f,O as g,ce as h,Z as i,m as j,b as k,ne as l,le as m,k as n,xe as o,fe as p,Q as r,Y as s};
